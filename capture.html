<!doctype html>
<html lang="th">

<head>
    <meta charset="utf-8" />
    <title>ESP32 Images</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { background:#f3f4f6; padding:24px; font-family: Arial;}
        h1 { font-size:24px; font-weight:700; color:#1e40af; text-align:center; margin-bottom:50px; }

        .grid {
            display:grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap:20px;
            max-width:1400px;
            margin:0 auto;
        }
        .card { background:white; border-radius:12px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,0.06); cursor:pointer; }
        .thumb { width:100%; aspect-ratio:16/9; object-fit:cover; background:#ddd; }
        .meta { padding:10px 14px; }
        .title { font-weight:600; font-size:15px; }
        .stats { font-size:12px; color:#64748b; margin-top:4px; }

        /* Popup preview */
        #previewOverlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:50;
        }
        #previewOverlay img { max-width:90%; max-height:90%; border-radius:12px; }
        #previewOverlay span { position:absolute; top:20px; right:30px; color:white; font-size:30px; cursor:pointer; }

  /* Sidebar */
  #sidebar {
    position: fixed;
    top: 0;
    left: -260px;
    width: 260px;
    height: 100%;
    background: white;
    box-shadow: 3px 0 12px rgba(0,0,0,0.15);
    padding: 20px;
    z-index: 60;
    transition: left 0.3s ease;
  }

  .sidebar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin: 10px;
}

.sidebar-header h2 {
  font-size: 24px;
  font-weight: bold;
  margin: 0;
}

.hamburger-btn {
  position: absolute;
  left: 1.25rem; /* left-5 */
  top: 1.25rem;  /* top-5 */
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
}

.hamburger-btn svg {
  width: 3em;
  height: 3em;
}

.hamburger-btn path {
  fill: none;
  stroke: rgb(0, 0, 0);
  stroke-width: 3;
  stroke-linecap: round;
  transition: stroke 0.2s ease;
}

/* hamburger */
.hamburger {
  cursor: pointer;
}

.hamburger input {
  display: none;
}

.hamburger svg {
  height: 2.5em;
  transition: transform 600ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* hover ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏µ‡∏à‡∏≤‡∏á‡∏•‡∏á */
.hamburger-btn:hover path {
  stroke: #1e40af;
}

.line {
  fill: none;
  stroke: #333;
  stroke-linecap: round;
  stroke-linejoin: round;
  stroke-width: 3;
  transition: stroke-dasharray 600ms cubic-bezier(0.4, 0, 0.2, 1),
              stroke-dashoffset 600ms cubic-bezier(0.4, 0, 0.2, 1);
}

.line-top-bottom {
  stroke-dasharray: 12 63;
}

.hamburger input:hover + svg {
  transform: rotate(-45deg);
}

.hamburger input:hover+ svg .line-top-bottom {
  stroke-dasharray: 20 300;
  stroke-dashoffset: -32.42;
}

#closeSidebarX {
  font-size: 32px;
  cursor: pointer;
  color: #333;
  font-weight: bold;
}

#sidebar.active { left: 0; }


#overlayBg {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.4);
      display:none;
      z-index:55;
  }

/* ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô Sidebar */
#sidebar a {
    display: block;
    padding: 12px 16px;
    border-radius: 999px;
    text-decoration: none;
    width: 100%;
    color: #1e40af;

    /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå */
    transition: 
        background 0.3s ease,
        color 0.3s ease,
        box-shadow 0.3s ease,
        transform 0.3s ease;
}

/* effect ‡∏Å‡∏•‡∏≤‡∏á ‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô */
#sidebar a.menu {
    display: block;
    padding: 10px 14px;
    border-radius: 999px;
    transition: all 0.3s ease;
}

/* ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å */
#sidebar a.home:hover {
    background: #487bdb;
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* ‡∏Å‡∏•‡πâ‡∏≠‡∏á */
#sidebar a.camera:hover {
    background: #10b981; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* ‡∏Å‡∏•‡πâ‡∏≠‡∏á2 */
#sidebar a.camera2:hover {
    background: #e6d308; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ */
#sidebar a.auto:hover {
    background: #eb9e05; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û */
#sidebar a.image:hover {
    background: #f50b0b; /* ‡∏™‡πâ‡∏° */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* FAQ */
#sidebar a.faq:hover {
    background: #ef348e; /* ‡πÅ‡∏î‡∏á */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}



  .sidebar-divider {
      width: 90%;
      height: 1px;
      background: #e5e7eb;
      margin: 100px 0;
  }

  
  
    </style>
</head>

<body>
<!-- üîµ ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏°‡∏Ç‡∏µ‡∏î -->
    <button id="menuBtn" class="hamburger-btn">
    <svg viewBox="0 0 32 32">
        <path d="M7 10 27 10"></path>
        <path d="M7 16 27 16"></path>
        <path d="M7 22 27 22"></path>
    </svg>
    </button>
<!-- üîµ SIDEBAR -->
<div id="sidebar">

    <div class="sidebar-header">
      <h2>Menu</h2>
      <label class="hamburger" id="closeSidebarBtn">
      <input type="checkbox" id="sidebarToggle">
      <svg viewBox="0 0 32 32">
        <path class="line line-top-bottom"
          d="M27 10 13 10C10.8 10 9 8.2 9 6
            9 3.5 10.8 2 13 2
            15.2 2 17 3.8 17 6
            L17 26C17 28.2 18.8 30
            21 30 23.2 30 25 28.2
            25 26 25 23.8 23.2 22
            21 22L7 22"></path>
        <path class="line" d="M7 16 27 16"></path>
      </svg>
    </label>
    </div>

    <ul class="space-y-3 margin-top-4">
        <li><a href="index.html" class="menu home text-blue-600">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="camera.html" class="menu camera text-blue-600">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á 1</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="camera2.html" class="menu camera2 text-blue-600">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á 2</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="auto.html" class="menu auto text-blue-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="capture.html" class="menu image text-blue-600">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="FAQ.html" class="menu faq text-blue-600">FAQ</a></li>
        <div class="sidebar-divider"></div>
    </ul>


    <!-- ‚≠ê ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ + Logout ‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‚≠ê -->
    <div id="sidebarUserBox" style="
        position: absolute;
        bottom: 20px;
        left: 20px;
        right: 20px;
    ">
        <div id="sidebarUsername"
            class="font-bold text-blue-700 mb-2">
            ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: -
        </div>

        <button id="sidebarLogoutBtn"
            class="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg font-bold transition">
            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        </button>
    </div>

</div>

<div id="overlayBg"></div>


    <!-- TITLE -->
    <h1>‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å ESP32-CAM</h1>

    <!-- IMAGE GRID -->
    <div id="grid" class="grid"></div>
    <div id="empty" class="text-center text-gray-500 mt-10" style="display:none;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>

    <!-- RELOAD BUTTON -->
    <button id="reloadBtn"
        class="fixed bottom-4 left-4 bg-blue-500 text-white px-5 py-3 rounded-full shadow-lg hover:bg-blue-600 transition">
        &#8635; ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
    </button>

    <!-- POPUP PREVIEW -->
    <div id="previewOverlay">
        <span id="closePreview">&times;</span>
        <img id="previewImage" src="" />
    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    const SUPABASE_URL = "https://yiaemxmwfxrfrwtogamw.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpYWVteG13ZnhyZnJ3dG9nYW13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1MzMwOTYsImV4cCI6MjA3NzEwOTA5Nn0.I9MQPD_2LgpyELygjOroGG5qRTcwySM_t7c1o-ZvZpw";
    
    const supabaseClient = supabase.createClient(
      SUPABASE_URL,
      SUPABASE_ANON_KEY
    );
    
    const BUCKET_NAME = "esp32-images";
    let currentUser = null;
    
    /* ===== Auth ===== */
    async function checkUser() {
      const { data: { session }, error } =
        await supabaseClient.auth.getSession();
    
      if (error || !session) {
        console.warn("No session");
        return;
      }
    
      currentUser = session.user;
      document.getElementById("sidebarUsername").textContent =
        "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: " + currentUser.email;
    
      loadImages();
    }
    
    /* ===== Load Images ===== */
    async function loadImages() {
      const empty = document.getElementById("empty");
      const grid = document.getElementById("grid");
    
      const { data: images, error } = await supabaseClient
        .from("user_images")
        .select("image_url, created_at")
        .order("created_at", { ascending: false });
    
        if (error) {
            console.error("SUPABASE ERROR:", error);
            empty.style.display = "block";
            empty.textContent = error.message;
            return;
        }

    
      if (!images || images.length === 0) {
        empty.style.display = "block";
        empty.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ";
        return;
      }
    
      empty.style.display = "none";
      grid.innerHTML = "";
    
      images.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";
    
        const img = document.createElement("img");
        img.className = "thumb";
    
        let imageUrl = "";
    
        if (item.image_url.startsWith("http")) {
          imageUrl = item.image_url;
        } else {
          const { data } = supabaseClient
            .storage
            .from(BUCKET_NAME)
            .getPublicUrl(item.image_url);
          imageUrl = data.publicUrl;
        }
    
        img.src = imageUrl;
    
        card.appendChild(img);
        grid.appendChild(card);
      });
    }
    
    /* ===== Sidebar ===== */
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlayBg");
    const toggle = document.getElementById("sidebarToggle");
    const closeBtn = document.getElementById("closeSidebarBtn");

    /* ‡πÄ‡∏õ‡∏¥‡∏î sidebar */
    document.getElementById("menuBtn").onclick = () => {
        sidebar.classList.add("active");
        overlay.style.display = "block";
        toggle.checked = true;
    };

    /* ‡∏õ‡∏¥‡∏î sidebar (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á) */
    overlay.onclick = closeSidebar;

    /* ‡∏õ‡∏¥‡∏î sidebar (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° X) */
    closeBtn.onclick = closeSidebar;

    function closeSidebar() {
    sidebar.classList.remove("active");
    overlay.style.display = "none";
    toggle.checked = false;
    }
    checkUser();
    </script>    

</body>
</html>
