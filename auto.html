<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { font-family: Arial; margin: 0; padding: 30px; background: #f3f4f6; display: flex; flex-direction: column; align-items: center; }
    h1 { font-size:24px; font-weight:700; color:#1e40af; text-align:left;}
    p { font-size: 15px; color:#adb5bd;}
.divide {
    width: 95%;
    height: 1px;
    background: #e5e7eb;
    margin: 20px 0;
  }
  /* Sidebar */
  #sidebar {
    position: fixed;
    top: 0;
    left: -260px;
    width: 260px;
    height: 100%;
    background: white;
    box-shadow: 3px 0 12px rgba(0,0,0,0.15);
    padding: 20px;
    z-index: 60;
    transition: left 0.3s ease;
  }

  .sidebar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin: 10px;
}

.sidebar-header h2 {
  font-size: 24px;
  font-weight: bold;
  margin: 0;
}

.hamburger-btn {
  position: absolute;
  left: 1.25rem; /* left-5 */
  top: 1.25rem;  /* top-5 */
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
}

.hamburger-btn svg {
  width: 3em;
  height: 3em;
}

.hamburger-btn path {
  fill: none;
  stroke: rgb(0, 0, 0);
  stroke-width: 3;
  stroke-linecap: round;
  transition: stroke 0.2s ease;
}

/* hamburger */
.hamburger {
  cursor: pointer;
}

.hamburger input {
  display: none;
}

.hamburger svg {
  height: 2.5em;
  transition: transform 600ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* hover ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏µ‡∏à‡∏≤‡∏á‡∏•‡∏á */
.hamburger-btn:hover path {
  stroke: #1e40af;
}

.line {
  fill: none;
  stroke: #333;
  stroke-linecap: round;
  stroke-linejoin: round;
  stroke-width: 3;
  transition: stroke-dasharray 600ms cubic-bezier(0.4, 0, 0.2, 1),
              stroke-dashoffset 600ms cubic-bezier(0.4, 0, 0.2, 1);
}

.line-top-bottom {
  stroke-dasharray: 12 63;
}

.hamburger input:hover + svg {
  transform: rotate(-45deg);
}

.hamburger input:hover+ svg .line-top-bottom {
  stroke-dasharray: 20 300;
  stroke-dashoffset: -32.42;
}

#closeSidebarX {
  font-size: 32px;
  cursor: pointer;
  color: #333;
  font-weight: bold;
}

#sidebar.active { left: 0; }


#overlayBg {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.4);
      display:none;
      z-index:55;
  }

/* ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô Sidebar */
#sidebar a {
    display: block;
    padding: 12px 16px;
    border-radius: 999px;
    text-decoration: none;
    width: 100%;
    color: #1e40af;

    /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå */
    transition: 
        background 0.3s ease,
        color 0.3s ease,
        box-shadow 0.3s ease,
        transform 0.3s ease;
}

/* effect ‡∏Å‡∏•‡∏≤‡∏á ‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô */
#sidebar a.menu {
    display: block;
    padding: 10px 14px;
    border-radius: 999px;
    transition: all 0.3s ease;
}

/* ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å */
#sidebar a.home:hover {
    background: #487bdb;
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* ‡∏Å‡∏•‡πâ‡∏≠‡∏á */
#sidebar a.camera:hover {
    background: #10b981; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* ‡∏Å‡∏•‡πâ‡∏≠‡∏á2 */
#sidebar a.camera2:hover {
    background: #e6d308; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ */
#sidebar a.auto:hover {
    background: #eb9e05; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û */
#sidebar a.image:hover {
    background: #f50b0b; /* ‡∏™‡πâ‡∏° */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

/* FAQ */
#sidebar a.faq:hover {
    background: #ef348e; /* ‡πÅ‡∏î‡∏á */
    color: #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}


  .sidebar-divider {
      width: 90%;
      height: 1px;
      background: #e5e7eb;
      margin: 100px 0;
  }

    /* The switch - the box around the slider */
.switch {
  font-size: 17px;
  position: relative;
  display: inline-block;
  width: 3.5em;
  height: 2em;
}

/* Hide default HTML checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #fff;
  border: 1px solid #adb5bd;
  transition: .4s;
  border-radius: 30px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 1.4em;
  width: 1.4em;
  border-radius: 20px;
  left: 0.27em;
  bottom: 0.25em;
  background-color: #adb5bd;
  transition: .4s;
}

input:checked + .slider {
  background-color: #007bff;
  border: 1px solid #007bff;
}

input:focus + .slider {
  box-shadow: 0 0 1px #007bff;
}

input:checked + .slider:before {
  transform: translateX(1.4em);
  background-color: #fff;
}

.auto-row {
  display: flex;
  align-items: center;      /* ‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
  justify-content: center;  /* ‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
  gap: 30px;                /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏ö‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå */
  width: 100%;
  margin-bottom: 30px;
}

/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô */
#autoFunctions {
  color:#1e40af;
  width: 100%;
  margin-top: 30px;
  margin-left: 30px;
  margin-right: 30px;
  display: flex;
  gap: 50px;
  flex-wrap: wrap;   /* ‚≠ê ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç */
  transition: opacity 0.3s;
}


#autoFunctions h2 {
    text-align: center;
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 25px;
}

/* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏¥‡∏î (‡∏à‡∏≤‡∏á + ‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ) */
#autoFunctions.disabled {
  opacity: 0.4;
  pointer-events: none; /* ‡∏´‡πâ‡∏≤‡∏°‡∏Ñ‡∏•‡∏¥‡∏Å */
  transition: opacity 0.3s;
}

.auto-item {
  display: flex;
  align-items: center;      /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
  justify-content: space-between;
  margin-bottom: 15px;
}

.auto-item p {
  color: black;
  margin: 0;
  font-size: 18px;
}



.yes, .no, .middle {
  flex: 1 1 400px;   /* ‚≠ê ‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å‡∏à‡∏∞‡πÑ‡∏´‡∏•‡∏•‡∏á */
  max-width: 100%;
  box-shadow: 0 10px 20px rgba(0,0,0,0.15);
  border-radius: 10px;
  background-color: white;
  padding: 30px;
}


.yes {
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    border-radius: 10px;
    background-color: white;
}

.no {
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    border-radius: 10px;
    background-color: white;
}

.middle {
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    border-radius: 10px;
    background-color: white;
}

.save {
  display: inline-block;
  transition: all 0.2s ease-in;
  position: relative;
  overflow: hidden;
  z-index: 1;
  color: #ffffff;
  padding: 10px 20px;
  margin-top: 50px;
  cursor: pointer;
  font-size: 18px;
  font-weight: bold;
  border-radius: 0.5em;
  background: #007bff;
  border: 1px solid #007bff;
  box-shadow: 6px 6px 12px #c5c5c5, -6px -6px 12px #ffffff;
}

.save:active {
  color: #666;
  box-shadow: inset 4px 4px 12px #c5c5c5, inset -4px -4px 12px #ffffff;
}

.save:before {
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%) scaleY(1) scaleX(1.25);
  top: 100%;
  width: 140%;
  height: 180%;
  background-color: rgba(0, 0, 0, 0.05);
  border-radius: 50%;
  display: block;
  transition: all 0.5s 0.1s cubic-bezier(0.55, 0, 0.1, 1);
  z-index: -1;
}

.save:after {
  content: "";
  position: absolute;
  left: 55%;
  transform: translateX(-50%) scaleY(1) scaleX(1.45);
  top: 180%;
  width: 160%;
  height: 190%;
  background-color: #007bff;
  border-radius: 50%;
  display: block;
  transition: all 0.5s 0.1s cubic-bezier(0.55, 0, 0.1, 1);
  z-index: -1;
}

.save:hover {
  color: #ffffff;
  border: 1px solid #007bff;
}

.save:hover:before {
  top: -35%;
  background-color: black;
  transform: translateX(-50%) scaleY(1.3) scaleX(0.8);
}

.save:hover:after {
  top: -45%;
  background-color: black;
  transform: translateX(-50%) scaleY(1.3) scaleX(0.8);
}

.save.disabled {
  opacity: 0.4;
  pointer-events: none;
  cursor: not-allowed;
  box-shadow: none;
}

/* ‚ùå ‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Ñ hover ‡πÄ‡∏°‡∏∑‡πà‡∏≠ disabled */
.save.disabled:hover {
  color: #ffffff;
  border: 1px solid #007bff;
}

/* ‚ùå ‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Ñ‡∏Ñ‡∏•‡∏∑‡πà‡∏ô */
.save.disabled::before,
.save.disabled::after {
  display: none;
}

/* ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤ */
.time-row {
  gap: 16px;
}

/* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á "‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤" */
.same-time {
  width: 100px;
  padding: 8px 12px;
  border-radius: 8px;
  border: 2px solid #d1d5db;
  background: #f9fafb;
  font-size: 15px;
  transition: 0.2s;
}

/* ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î */
.same-time:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß */
.same-time:not(:disabled) {
  background: #ffffff;
  border-color: #3b82f6;
}

/* focus */
.same-time:focus {
  outline: none;
  box-shadow: 0 0 0 2px rgba(59,130,246,0.2);
}

/* ‡πÅ‡∏ñ‡∏ß‡∏´‡∏•‡∏±‡∏Å */
.time-row {
  justify-content: space-between;
}

/* ‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå + ‡πÄ‡∏ß‡∏•‡∏≤ */
.time-control {
  display: flex;
  align-items: center;
  gap: 10px;          /* ‚≠ê ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ */
}

/* ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤ */
.same-time {
  width: 100px;
}

/* ‡∏ö‡∏ô‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
@media (max-width: 640px) {
  .time-row {
    flex-direction: column;
    align-items: flex-start;
  }

  .time-control {
    width: 100%;
    justify-content: flex-end;
  }
}



</style>
</head>
<body>

  <!-- üîµ ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏°‡∏Ç‡∏µ‡∏î -->
    <button id="menuBtn" class="hamburger-btn">
    <svg viewBox="0 0 32 32">
        <path d="M7 10 27 10"></path>
        <path d="M7 16 27 16"></path>
        <path d="M7 22 27 22"></path>
    </svg>
    </button>

<!-- üîµ SIDEBAR -->
<div id="sidebar">

    <div class="sidebar-header">
      <h2>Menu</h2>
      <label class="hamburger" id="closeSidebarBtn">
      <input type="checkbox" id="sidebarToggle">
      <svg viewBox="0 0 32 32">
        <path class="line line-top-bottom"
          d="M27 10 13 10C10.8 10 9 8.2 9 6
            9 3.5 10.8 2 13 2
            15.2 2 17 3.8 17 6
            L17 26C17 28.2 18.8 30
            21 30 23.2 30 25 28.2
            25 26 25 23.8 23.2 22
            21 22L7 22"></path>
        <path class="line" d="M7 16 27 16"></path>
      </svg>
    </label>
    </div>

    <ul class="space-y-3 margin-top-4">
        <li><a href="index.html" class="menu home text-blue-600">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="camera.html" class="menu camera text-blue-600">‡πÅ‡∏Ç‡∏ô‡∏Å‡∏• 1</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="camera2.html" class="menu camera2 text-blue-600">‡πÅ‡∏Ç‡∏ô‡∏Å‡∏• 2</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="auto.html" class="menu auto text-blue-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="capture.html" class="menu image text-blue-600">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</a></li>
        <div class="sidebar-divider"></div>

        <li><a href="FAQ.html" class="menu faq text-blue-600">‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ</a></li>
        <div class="sidebar-divider"></div>
    </ul>

    <!-- ‚≠ê ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ + Logout ‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‚≠ê -->
    <div id="sidebarUserBox" style="
        position: absolute;
        bottom: 20px;
        left: 20px;
        right: 20px;
    ">
        <div id="sidebarUsername"
            class="font-bold text-blue-700 mb-2">
            ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: -
        </div>

        <button id="sidebarLogoutBtn"
            class="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg font-bold transition">
            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        </button>
    </div>

</div>

<div id="overlayBg"></div>


<div class="auto-row">
  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h1>

  <label class="switch">
    <input type="checkbox" id="autoSwitch">
    <span class="slider"></span>
  </label>
</div>

<p>‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</p>

<div class="divide"></div>

<!-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á -->
<div id="autoFunctions" class="disabled">
  <div class="yes">
    <h2>‡πÅ‡∏Ç‡∏ô‡∏Å‡∏• 1</h2>

    <div class="auto-item time-row">
      <p>‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</p>

      <div class="time-control">
        <label class="switch">
          <input type="checkbox" id="moistureA">
          <span class="slider"></span>
        </label>

        <input
          type="time"
          id="moistureTimeA"
          class="time-input same-time"
          disabled
        >
      </div>
    </div>

    <div class="auto-item time-row">
      <p>‡∏£‡∏î‡∏ô‡πâ‡∏≥‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤</p>

      <div class="time-control">
        <label class="switch">
          <input type="checkbox" id="waterA">
          <span class="slider"></span>
        </label>

        <input
          type="time"
          id="waterTimeA"
          class="time-input same-time"
          disabled
        >
      </div>
    </div>

  </div>

  <div class="no">
    <h2>‡πÅ‡∏Ç‡∏ô‡∏Å‡∏• 2</h2>

    <div class="auto-item time-row">
      <p>‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</p>

      <div class="time-control">
        <label class="switch">
          <input type="checkbox" id="moistureB">
          <span class="slider"></span>
        </label>

        <input
          type="time"
          id="moistureTimeB"
          class="time-input same-time"
          disabled
        >
      </div>
    </div>

    <div class="auto-item time-row">
      <p>‡∏£‡∏î‡∏ô‡πâ‡∏≥‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤</p>

      <div class="time-control">
        <label class="switch">
          <input type="checkbox" id="waterB">
          <span class="slider"></span>
        </label>

        <input
          type="time"
          id="waterTimeB"
          class="time-input same-time"
          disabled
        >
      </div>
    </div>
  </div>

  <div class="middle">
    <h2>‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ</h2>

    <div class="auto-item time-row">
      <p>‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü</p>

      <div class="time-control">
        <label class="switch">
          <input type="checkbox" id="lightOnSwitch">
          <span class="slider"></span>
        </label>

        <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î -->
        <input
          type="time"
          id="lightOnTime"
          class="time-input same-time"
          disabled
        >

        <p> ‡∏ñ‡∏∂‡∏á </p>

        <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î -->
        <input
          type="time"
          id="lightOffTime"
          class="time-input same-time"
          disabled
        >
      </div>
    </div>



    <div class="auto-item time-row">
      <p>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå‡πÄ‡∏ã‡∏•‡∏•‡πå</p>

      <div class="time-control">
        <label class="switch">
          <input type="checkbox" id="solarSwitch">
          <span class="slider"></span>
        </label>

        <input
          type="time"
          id="solarTime"
          class="time-input same-time"
          disabled
        >
      </div>
    </div>
  </div>
</div>



<button id="saveBtn" class="disabled save">Save</button>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://yiaemxmwfxrfrwtogamw.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpYWVteG13ZnhyZnJ3dG9nYW13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1MzMwOTYsImV4cCI6MjA3NzEwOTA5Nn0.I9MQPD_2LgpyELygjOroGG5qRTcwySM_t7c1o-ZvZpw";
const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentUser = null;
let currentPoint = {x:0,y:0};
let chart = null;

// ‡πÄ‡∏ä‡πá‡∏Ñ user
async function checkUser(){
  const { data: { session } } = await supabaseClient.auth.getSession();
  if(!session || !session.user){ window.location.href="login.html"; return; }
  currentUser = session.user;
  document.getElementById("sidebarUsername").textContent = `‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${currentUser.email}`;
  document.getElementById("app").style.display="block";
  initGrid();
}
checkUser();

// logout
document.getElementById("sidebarLogoutBtn").addEventListener("click", async ()=>{
  const {error} = await supabaseClient.auth.signOut();
  if(error) console.error(error.message); else window.location.href="login.html";
});

  document.addEventListener("DOMContentLoaded", () => {
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlayBg");
  const toggle = document.getElementById("sidebarToggle");
  const menuBtn = document.getElementById("menuBtn");

  if (!sidebar || !overlay || !menuBtn) return;

  // ‡πÄ‡∏õ‡∏¥‡∏î sidebar
  menuBtn.addEventListener("click", () => {
    sidebar.classList.add("active");
    overlay.style.display = "block";
    if (toggle) toggle.checked = true;
  });

  // ‡∏Å‡∏î hamburger ‡∏õ‡∏¥‡∏î
  if (toggle) {
    toggle.addEventListener("change", () => {
      if (!toggle.checked) {
        sidebar.classList.remove("active");
        overlay.style.display = "none";
      }
    });
  }

  // ‡∏Ñ‡∏•‡∏¥‡∏Å overlay ‡∏õ‡∏¥‡∏î
  overlay.addEventListener("click", () => {
    sidebar.classList.remove("active");
    overlay.style.display = "none";
    if (toggle) toggle.checked = false;
  });
});



/***********************
 * AUTO SYSTEM CONTROL
 ***********************/
const autoSwitch    = document.getElementById("autoSwitch");
const autoFunctions = document.getElementById("autoFunctions");
const saveBtn       = document.getElementById("saveBtn");

/* ===== ‡πÄ‡∏õ‡∏¥‡∏î / ‡∏õ‡∏¥‡∏î ‡∏£‡∏∞‡∏ö‡∏ö ===== */
autoSwitch.addEventListener("change", async () => {
  const { data: { user } } = await supabaseClient.auth.getUser();

  if (!user) {
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login");
    autoSwitch.checked = false;
    return;
  }

  if (autoSwitch.checked) {
    autoFunctions.classList.remove("disabled");
    saveBtn.classList.remove("disabled");
  } else {
    autoFunctions.classList.add("disabled");
    saveBtn.classList.add("disabled");

    await supabaseClient
      .from("auto_tasks")
      .update({ enable: false })
      .eq("user_id", user.id);
  }
});

/***********************
 * BIND CHECKBOX ‚Üí TIME
 ***********************/
function bindTime(cbId, timeId) {
  const cb   = document.getElementById(cbId);
  const time = document.getElementById(timeId);
  if (!cb || !time) return;

  time.disabled = !cb.checked;

  cb.addEventListener("change", () => {
    time.disabled = !cb.checked;
    if (!cb.checked) time.value = "";
  });
}

/* ‡πÅ‡∏Ç‡∏ô‡∏Å‡∏• / ‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå */
bindTime("moistureA", "moistureTimeA");
bindTime("waterA", "waterTimeA");
bindTime("moistureB", "moistureTimeB");
bindTime("waterB", "waterTimeB");
bindTime("solarSwitch", "solarTime");

/***********************
 * LIGHT CONTROL
 ***********************/
const lightOnSwitch = document.getElementById("lightOnSwitch");
const lightOnTime   = document.getElementById("lightOnTime");
const lightOffTime  = document.getElementById("lightOffTime");

lightOnSwitch.addEventListener("change", () => {
  const enabled = lightOnSwitch.checked;

  lightOnTime.disabled  = !enabled;
  lightOffTime.disabled = !enabled;

  if (!enabled) {
    lightOnTime.value  = "";
    lightOffTime.value = "";
  }
});

/***********************
 * SAVE DATA
 ***********************/
saveBtn.addEventListener("click", async () => {
  const { data: { user } } = await supabaseClient.auth.getUser();
  if (!user) {
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login");
    return;
  }

  const rows = [];

  function addTask({ arm, measure, water, solarcell, hour, minute }) {
    rows.push({
      enable: true,
      arm: arm ?? null,
      measure: measure ?? null,
      water: water ?? null,
      solarcell: solarcell ?? null,
      light_state: null,
      hour,
      minute,
      user_id: user.id
    });
  }

  /* ===== ‡πÅ‡∏Ç‡∏ô‡∏Å‡∏• A ===== */
  if (moistureA.checked && moistureTimeA.value) {
    const [h, m] = moistureTimeA.value.split(":").map(Number);
    addTask({ arm: "A", measure: true, hour: h, minute: m });
  }

  if (waterA.checked && waterTimeA.value) {
    const [h, m] = waterTimeA.value.split(":").map(Number);
    addTask({ arm: "A", water: true, hour: h, minute: m });
  }

  /* ===== ‡πÅ‡∏Ç‡∏ô‡∏Å‡∏• B ===== */
  if (moistureB.checked && moistureTimeB.value) {
    const [h, m] = moistureTimeB.value.split(":").map(Number);
    addTask({ arm: "B", measure: true, hour: h, minute: m });
  }

  if (waterB.checked && waterTimeB.value) {
    const [h, m] = waterTimeB.value.split(":").map(Number);
    addTask({ arm: "B", water: true, hour: h, minute: m });
  }

  /* ===== ‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå‡πÄ‡∏ã‡∏•‡∏•‡πå ===== */
  if (solarSwitch.checked && solarTime.value) {
    const [h, m] = solarTime.value.split(":").map(Number);
    addTask({ solarcell: true, hour: h, minute: m });
  }

  /* ===== ‡πÑ‡∏ü (ON / OFF ‡πÅ‡∏¢‡∏Å 2 ‡πÅ‡∏ñ‡∏ß) ===== */
  if (lightOnSwitch.checked) {

    if (!lightOnTime.value || !lightOffTime.value) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î‡πÑ‡∏ü");
      return;
    }

    // üîÜ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü
    const [onH, onM] = lightOnTime.value.split(":").map(Number);
    rows.push({
      enable: true,
      light_state: "ON",
      hour: onH,
      minute: onM,
      user_id: user.id
    });

    // üåô ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü
    const [offH, offM] = lightOffTime.value.split(":").map(Number);
    rows.push({
      enable: true,
      light_state: "OFF",
      hour: offH,
      minute: offM,
      user_id: user.id
    });
  }

  if (rows.length === 0) {
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£");
    return;
  }

  /* ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤ */
  await supabaseClient
    .from("auto_tasks")
    .update({ enable: false })
    .eq("user_id", user.id);

  /* insert ‡πÉ‡∏´‡∏°‡πà */
  const { error } = await supabaseClient
    .from("auto_tasks")
    .insert(rows);

  if (error) {
    console.error(error);
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    return;
  }

  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
});

/***********************
 * LOAD DATA
 ***********************/
async function loadAutoTasks() {
  const { data: { user } } = await supabaseClient.auth.getUser();
  if (!user) return;

  const { data, error } = await supabaseClient
    .from("auto_tasks")
    .select("*")
    .eq("user_id", user.id)
    .eq("enable", true);

  if (error || !data || data.length === 0) return;

  autoSwitch.checked = true;
  autoFunctions.classList.remove("disabled");
  saveBtn.classList.remove("disabled");

  data.forEach(task => {
    const timeValue =
      String(task.hour).padStart(2, "0") + ":" +
      String(task.minute).padStart(2, "0");

    if (task.arm === "A" && task.measure) {
      moistureA.checked = true;
      moistureTimeA.disabled = false;
      moistureTimeA.value = timeValue;
    }

    if (task.arm === "A" && task.water) {
      waterA.checked = true;
      waterTimeA.disabled = false;
      waterTimeA.value = timeValue;
    }

    if (task.arm === "B" && task.measure) {
      moistureB.checked = true;
      moistureTimeB.disabled = false;
      moistureTimeB.value = timeValue;
    }

    if (task.arm === "B" && task.water) {
      waterB.checked = true;
      waterTimeB.disabled = false;
      waterTimeB.value = timeValue;
    }

    if (task.solarcell) {
      solarSwitch.checked = true;
      solarTime.disabled = false;
      solarTime.value = timeValue;
    }

    if (task.light_state === "ON") {
      lightOnSwitch.checked = true;
      lightOnSwitch.dispatchEvent(new Event("change"));
      lightOnTime.value = timeValue;
    }

    if (task.light_state === "OFF") {
      lightOffTime.value = timeValue;
    }
  });
}

window.addEventListener("DOMContentLoaded", loadAutoTasks);

</script>
</body>
</html>